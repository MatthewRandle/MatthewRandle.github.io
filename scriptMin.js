let commentSection, iframe; function createFrame() { null == iframe && (iframe = document.createElement("iframe")), iframe.style.width = "100%", iframe.style.border = "none", iframe.setAttribute("src", `http://localhost:3000/embed/comment-section/${commenzeHostname}/linkedID=${getCommentID() || "null"}`), iframe.setAttribute("scrolling", "no"), iframe.id = "commentSectionFrame", commentSection.appendChild(iframe), iFrameResize({ onMessage: e => { "logout" === e.message.command ? logout() : "sign-in" === e.message.command ? signIn() : "sign-up" === e.message.command ? signUp() : "link" === e.message.command ? window.open(e.message.link, "_self") : "link-blank" === e.message.command && window.open(e.message.link, "_blank") }, heightCalculationMethod: "lowestElement" }, "#commentSectionFrame") } function getCommentID() { var e = null, n = []; return window.location.search.substr(1).split("&").forEach(function (t) { "commentID" === (n = t.split("="))[0] && (e = decodeURIComponent(n[1])) }), e } function signIn() { let e = window.open("http://localhost:3000/embed/sign-in", "", "directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=477,height=650"); window.addEventListener("message", function (n) { if ("http://localhost:3000" !== n.origin) return; "signed-in" === n.data && (e.close(), iframe.contentWindow.postMessage("signed-in", "http://localhost:3000/embed/comment-section")) }, !1) } function commenzeSignIn(e, n, t) { iframe.contentWindow.postMessage({ message: "sso-sign-in", username: n, email: e, expiresIn: t }, "http://localhost:3000/embed/comment-section") } function commenzeSignOut() { iframe.contentWindow.postMessage("sso-sign-out", "http://localhost:3000/embed/comment-section") } function signUp() { let e = window.open("http://localhost:3000/embed/sign-up", "", "directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=477,height=725"); window.addEventListener("message", function (n) { if ("http://localhost:3000" !== n.origin) return; "signed-up" === n.data && (console.log("SIGNED UP"), e.close(), iframe.contentWindow.postMessage("signed-up", "http://localhost:3000/embed/comment-section")) }, !1) } !function (e) { if ("undefined" != typeof window) { var n, t = 0, i = !1, o = !1, r = "message".length, a = "[iFrameSizer]", s = a.length, c = null, d = window.requestAnimationFrame, l = { max: 1, scroll: 1, bodyScroll: 1, documentElementScroll: 1 }, m = {}, u = null, f = { autoResize: !0, bodyBackground: null, bodyMargin: null, bodyMarginV1: 8, bodyPadding: null, checkOrigin: !0, inPageLinks: !1, enablePublicMethods: !0, heightCalculationMethod: "bodyOffset", id: "iFrameResizer", interval: 32, log: !1, maxHeight: 1 / 0, maxWidth: 1 / 0, minHeight: 0, minWidth: 0, resizeFrom: "parent", scrolling: !1, sizeHeight: !0, sizeWidth: !1, warningTimeout: 5e3, tolerance: 0, widthCalculationMethod: "scroll", onClosed: function () { }, onInit: function () { }, onMessage: function () { I("onMessage function not defined") }, onResized: function () { }, onScroll: function () { return !0 } }, g = {}; window.jQuery && ((n = window.jQuery).fn ? n.fn.iFrameResize || (n.fn.iFrameResize = function (e) { return this.filter("iframe").each(function (n, t) { H(t, e) }).end() }) : v("", "Unable to bind to jQuery, it is not fully loaded.")), "function" == typeof define && define.amd ? define([], L) : "object" == typeof module && "object" == typeof module.exports && (module.exports = L()), window.iFrameResize = window.iFrameResize || L() } function h() { return window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver } function w(e, n, t) { e.addEventListener(n, t, !1) } function p(e, n, t) { e.removeEventListener(n, t, !1) } function b(e) { return m[e] ? m[e].log : i } function y(e, n) { M("log", e, n, b(e)) } function v(e, n) { M("info", e, n, b(e)) } function I(e, n) { M("warn", e, n, !0) } function M(e, n, t, i) { !0 === i && "object" == typeof window.console && console[e](function (e) { return a + "[" + (t = "Host page: " + (n = e), window.top !== window.self && (t = window.parentIFrame && window.parentIFrame.getId ? window.parentIFrame.getId() + ": " + n : "Nested host page: " + n), t) + "]"; var n, t }(n), t) } function F(e) { function n() { t("Height"), t("Width"), W(function () { S(P), R(j), f("onResized", P) }, P, "init") } function t(e) { var n = Number(m[j]["max" + e]), t = Number(m[j]["min" + e]), i = e.toLowerCase(), o = Number(P[i]); y(j, "Checking " + i + " is in range " + t + "-" + n), o < t && (o = t, y(j, "Set " + i + " to min value")), n < o && (o = n, y(j, "Set " + i + " to max value")), P[i] = "" + o } function i(e) { return H.substr(H.indexOf(":") + r + e) } function o(e, n) { var t, i; t = function () { var t, i; C("Send Page Info", "pageInfo:" + (t = document.body.getBoundingClientRect(), i = P.iframe.getBoundingClientRect(), JSON.stringify({ iframeHeight: i.height, iframeWidth: i.width, clientHeight: Math.max(document.documentElement.clientHeight, window.innerHeight || 0), clientWidth: Math.max(document.documentElement.clientWidth, window.innerWidth || 0), offsetTop: parseInt(i.top - t.top, 10), offsetLeft: parseInt(i.left - t.left, 10), scrollTop: window.pageYOffset, scrollLeft: window.pageXOffset, documentHeight: document.documentElement.clientHeight, documentWidth: document.documentElement.clientWidth, windowHeight: window.innerHeight, windowWidth: window.innerWidth })), e, n) }, g[i = n] || (g[i] = setTimeout(function () { g[i] = null, t() }, 32)) } function d(e) { var n = e.getBoundingClientRect(); return E(j), { x: Math.floor(Number(n.left) + Number(c.x)), y: Math.floor(Number(n.top) + Number(c.y)) } } function l(e) { var n = e ? d(P.iframe) : { x: 0, y: 0 }, t = { x: Number(P.width) + n.x, y: Number(P.height) + n.y }; y(j, "Reposition requested from iFrame (offset x:" + n.x + " y:" + n.y + ")"), window.top !== window.self ? window.parentIFrame ? window.parentIFrame["scrollTo" + (e ? "Offset" : "")](t.x, t.y) : I(j, "Unable to scroll to requested position, window.parentIFrame not found") : (c = t, u(), y(j, "--")) } function u() { !1 !== f("onScroll", c) ? R(j) : O() } function f(e, n) { return k(j, e, n) } var h, b, M, F, z, H = e.data, P = {}, j = null; "[iFrameResizerChild]Ready" === H ? function () { for (var e in m) C("iFrame requested init", N(e), document.getElementById(e), e) }() : a === ("" + H).substr(0, s) && H.substr(s).split(":")[0] in m ? (z = H.substr(s).split(":"), P = { iframe: m[z[0]] && m[z[0]].iframe, id: z[0], height: z[1], width: z[2], type: z[3] }, j = P.id, m[j] && (m[j].loaded = !0), (F = P.type in { true: 1, false: 1, undefined: 1 }) && y(j, "Ignoring init message from meta parent page"), !F && (M = !0, m[b = j] || (M = !1, I(P.type + " No settings for " + b + ". Message was: " + H)), M) && (y(j, "Received: " + H), h = !0, null === P.iframe && (I(j, "IFrame (" + P.id + ") not found"), h = !1), h && function () { var n, t = e.origin, i = m[j] && m[j].checkOrigin; if (i && "" + t != "null" && !(i.constructor === Array ? function () { var e = 0, n = !1; for (y(j, "Checking connection is from allowed list of origins: " + i); e < i.length; e++)if (i[e] === t) { n = !0; break } return n }() : (n = m[j] && m[j].remoteHost, y(j, "Checking connection is from: " + n), t === n))) throw new Error("Unexpected message received from: " + t + " for " + P.iframe.id + ". Message was: " + e.data + ". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains."); return !0 }() && function () { switch (m[j] && m[j].firstRun && m[j] && (m[j].firstRun = !1), P.type) { case "close": m[j].closeRequeston ? k(j, "onCloseRequest", m[j].iframe) : x(P.iframe); break; case "message": s = i(6), y(j, "onMessage passed: {iframe: " + P.iframe.id + ", message: " + s + "}"), f("onMessage", { iframe: P.iframe, message: JSON.parse(s) }), y(j, "--"); break; case "scrollTo": l(!1); break; case "scrollToOffset": l(!0); break; case "pageInfo": o(m[j] && m[j].iframe, j), function () { function e(e, i) { function r() { m[t] ? o(m[t].iframe, t) : n() } ["scroll", "resize"].forEach(function (n) { y(t, e + n + " listener for sendPageInfo"), i(window, n, r) }) } function n() { e("Remove ", p) } var t = j; e("Add ", w), m[t] && (m[t].stopPageInfo = n) }(); break; case "pageInfoStop": m[j] && m[j].stopPageInfo && (m[j].stopPageInfo(), delete m[j].stopPageInfo); break; case "inPageLink": t = i(9).split("#")[1] || "", r = decodeURIComponent(t), (a = document.getElementById(r) || document.getElementsByName(r)[0]) ? (e = d(a), y(j, "Moving to in page link (#" + t + ") at x: " + e.x + " y: " + e.y), c = { x: e.x, y: e.y }, u(), y(j, "--")) : window.top !== window.self ? window.parentIFrame ? window.parentIFrame.moveToAnchor(t) : y(j, "In page link #" + t + " not found and window.parentIFrame not found") : y(j, "In page link #" + t + " not found"); break; case "reset": T(P); break; case "init": n(), f("onInit", P.iframe); break; default: n() }var e, t, r, a, s }())) : v(j, "Ignored: " + H) } function k(e, n, t) { var i = null, o = null; if (m[e]) { if ("function" != typeof (i = m[e][n])) throw new TypeError(n + " on iFrame[" + e + "] is not a function"); o = i(t) } return o } function z(e) { var n = e.id; delete m[n] } function x(e) { var n = e.id; y(n, "Removing iFrame: " + n); try { e.parentNode && e.parentNode.removeChild(e) } catch (e) { I(e) } k(n, "onClosed", n), y(n, "--"), z(e) } function E(n) { null === c && y(n, "Get page position: " + (c = { x: window.pageXOffset !== e ? window.pageXOffset : document.documentElement.scrollLeft, y: window.pageYOffset !== e ? window.pageYOffset : document.documentElement.scrollTop }).x + "," + c.y) } function R(e) { null !== c && (window.scrollTo(c.x, c.y), y(e, "Set page position: " + c.x + "," + c.y), O()) } function O() { c = null } function T(e) { y(e.id, "Size reset requested by " + ("init" === e.type ? "host page" : "iFrame")), E(e.id), W(function () { S(e), C("reset", "reset", e.iframe, e.id) }, e, "reset") } function S(e) { function n(n) { o || "0" !== e[n] || (o = !0, y(i, "Hidden iFrame detected, creating visibility listener"), function () { function e() { Object.keys(m).forEach(function (e) { !function (e) { function n(n) { return "0px" === (m[e] && m[e].iframe.style[n]) } m[e] && null !== m[e].iframe.offsetParent && (n("height") || n("width")) && C("Visibility change", "resize", m[e].iframe, e) }(m[e]) }) } var n, t, i = h(); i && (n = document.querySelector("body"), t = { attributes: !0, attributeOldValue: !1, characterData: !0, characterDataOldValue: !1, childList: !0, subtree: !0 }, new i(function (n) { y("window", "Mutation observed: " + n[0].target + " " + n[0].type), P(e, 16) }).observe(n, t)) }()) } function t(t) { var o; o = t, e.id ? (e.iframe.style[o] = e[o] + "px", y(e.id, "IFrame (" + i + ") " + o + " set to " + e[o] + "px")) : y("undefined", "messageData id not set"), n(t) } var i = e.iframe.id; m[i] && (m[i].sizeHeight && t("height"), m[i].sizeWidth && t("width")) } function W(e, n, t) { t !== n.type && d ? (y(n.id, "Requesting animation frame"), d(e)) : e() } function C(e, n, t, i, o) { var r, s = !1; i = i || t.id, m[i] && (t && "contentWindow" in t && null !== t.contentWindow ? (r = m[i] && m[i].targetOrigin, y(i, "[" + e + "] Sending msg to iframe[" + i + "] (" + n + ") targetOrigin: " + r), t.contentWindow.postMessage(a + n, r)) : I(i, "[" + e + "] IFrame(" + i + ") not found"), o && m[i] && m[i].warningTimeout && (m[i].msgTimeout = setTimeout(function () { !m[i] || m[i].loaded || s || (s = !0, I(i, "IFrame has not responded within " + m[i].warningTimeout / 1e3 + " seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ignored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning.")) }, m[i].warningTimeout))) } function N(e) { return e + ":" + m[e].bodyMarginV1 + ":" + m[e].sizeWidth + ":" + m[e].log + ":" + m[e].interval + ":" + m[e].enablePublicMethods + ":" + m[e].autoResize + ":" + m[e].bodyMargin + ":" + m[e].heightCalculationMethod + ":" + m[e].bodyBackground + ":" + m[e].bodyPadding + ":" + m[e].tolerance + ":" + m[e].inPageLinks + ":" + m[e].resizeFrom + ":" + m[e].widthCalculationMethod } function H(n, o) { var r, a, s, c, d, u, g, p = ("" === (r = n.id) && (n.id = (a = o && o.id || f.id + t++, null !== document.getElementById(a) && (a += t++), r = a), i = (o || {}).log, y(r, "Added missing iframe ID: " + r + " (" + n.src + ")")), r); p in m && "iFrameResizer" in n ? I(p, "Ignored iFrame, already setup.") : (u = (u = o) || {}, m[p] = { firstRun: !0, iframe: n, remoteHost: n.src.split("/").slice(0, 3).join("/") }, function (e) { if ("object" != typeof u) throw new TypeError("Options is not an object") }(), Object.keys(u).forEach(function (e) { var n = e.split("Callback"); if (2 === n.length) { var t = "on" + n[0].charAt(0).toUpperCase() + n[0].slice(1); this[t] = this[e], delete this[e], I(p, "Deprecated: '" + e + "' has been renamed '" + t + "'. The old method will be removed in the next major version.") } }, u), function (e) { for (var n in f) Object.prototype.hasOwnProperty.call(f, n) && (m[p][n] = Object.prototype.hasOwnProperty.call(e, n) ? e[n] : f[n]) }(u), m[p] && (m[p].targetOrigin = !0 === m[p].checkOrigin ? "" === (g = m[p].remoteHost) || "file://" === g ? "*" : g : "*"), function () { switch (y(p, "IFrame scrolling " + (m[p] && m[p].scrolling ? "enabled" : "disabled") + " for " + p), n.style.overflow = !1 === (m[p] && m[p].scrolling) ? "hidden" : "auto", m[p] && m[p].scrolling) { case "omit": break; case !0: n.scrolling = "yes"; break; case !1: n.scrolling = "no"; break; default: n.scrolling = m[p] ? m[p].scrolling : "no" } }(), function () { function e(e) { 1 / 0 !== m[p][e] && 0 !== m[p][e] && (n.style[e] = m[p][e] + "px", y(p, "Set " + e + " = " + m[p][e] + "px")) } function t(e) { if (m[p]["min" + e] > m[p]["max" + e]) throw new Error("Value for min" + e + " can not be greater than max" + e) } t("Height"), t("Width"), e("maxHeight"), e("minHeight"), e("maxWidth"), e("minWidth") }(), "number" != typeof (m[p] && m[p].bodyMargin) && "0" !== (m[p] && m[p].bodyMargin) || (m[p].bodyMarginV1 = m[p].bodyMargin, m[p].bodyMargin = m[p].bodyMargin + "px"), s = N(p), (d = h()) && (c = d, n.parentNode && new c(function (e) { e.forEach(function (e) { Array.prototype.slice.call(e.removedNodes).forEach(function (e) { e === n && x(n) }) }) }).observe(n.parentNode, { childList: !0 })), w(n, "load", function () { var t, i; C("iFrame.onload", s, n, e, !0), t = m[p] && m[p].firstRun, i = m[p] && m[p].heightCalculationMethod in l, !t && i && T({ iframe: n, height: 0, width: 0, type: "init" }) }), C("init", s, n, e, !0), m[p] && (m[p].iframe.iFrameResizer = { close: x.bind(null, m[p].iframe), removeListeners: z.bind(null, m[p].iframe), resize: C.bind(null, "Window resize", "resize", m[p].iframe), moveToAnchor: function (e) { C("Move to anchor", "moveToAnchor:" + e, m[p].iframe, p) }, sendMessage: function (e) { C("Send Message", "message:" + (e = JSON.stringify(e)), m[p].iframe, p) } })) } function P(e, n) { null === u && (u = setTimeout(function () { u = null, e() }, n)) } function j() { "hidden" !== document.visibilityState && (y("document", "Trigger event: Visiblity change"), P(function () { A("Tab Visable", "resize") }, 16)) } function A(e, n) { Object.keys(m).forEach(function (t) { var i; m[i = t] && "parent" === m[i].resizeFrom && m[i].autoResize && !m[i].firstRun && C(e, n, document.getElementById(t), t) }) } function L() { function n(e, n) { n && (function () { if (!n.tagName) throw new TypeError("Object is not a valid DOM element"); if ("IFRAME" !== n.tagName.toUpperCase()) throw new TypeError("Expected <IFRAME> tag, found <" + n.tagName + ">") }(), H(n, e), t.push(n)) } var t; return function () { var e, n = ["moz", "webkit", "o", "ms"]; for (e = 0; e < n.length && !d; e += 1)d = window[n[e] + "RequestAnimationFrame"]; d || y("setup", "RequestAnimationFrame not supported") }(), w(window, "message", F), w(window, "resize", function () { y("window", "Trigger event: resize"), P(function () { A("Window resize", "resize") }, 16) }), w(document, "visibilitychange", j), w(document, "-webkit-visibilitychange", j), function (i, o) { var r; switch (t = [], (r = i) && r.enablePublicMethods && I("enablePublicMethods option has been removed, public methods are now always available in the iFrame"), typeof o) { case "undefined": case "string": Array.prototype.forEach.call(document.querySelectorAll(o || "iframe"), n.bind(e, i)); break; case "object": n(i, o); break; default: throw new TypeError("Unexpected data type (" + typeof o + ")") }return t } } }(), window.onload = (() => { commentSection = document.getElementById("commentSection"), createFrame() });